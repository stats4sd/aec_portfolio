import{c as j,a as $,o as E,e as p,f as m,g as u,j as A,A as e,E as d,D as w,v as T,F as S,i as I,H as M,ag as B,ah as O,ai as R,m as y,y as C,q as P,s as F,V as z,W as L}from"./vue.esm-bundler.b2fc0ee9.js";import{b as q,e as Y,f as D,g as G,h as H,i as W,j as X,k as J,c as K,a as Q,d as Z}from"./index.e96f1742.js";import{_ as ee}from"./_plugin-vue_export-helper.cdc0426e.js";const f=s=>(B("data-v-4065560d"),s=s(),O(),s),se={class:"card-title text-bright-green pt-8 pb-0 px-12"},te={class:"h-100 d-flex"},le={class:"col-md-6 px-12 py-4 h-100"},ae=f(()=>e("h4",null,"RATING",-1)),ne={class:"pb-8 mb-4"},ie={key:0,class:"alert alert-info"},oe={class:"card bg-bright-green text-white rounded-b-xl rounded-t-xl mb-16"},ce={class:"card-body p-4 px-8"},de=f(()=>e("h3",{class:"card-title"},"Definitions",-1)),re={class:"align-text-top"},pe=f(()=>e("td",{class:"align-text-top pr-4 pb-4"},"2",-1)),ue={class:"align-text-top pr-4 pb-4"},me=f(()=>e("td",{class:"align-text-top pr-4 pb-4"},"1",-1)),he={class:"align-text-top pr-4 pb-4"},_e=f(()=>e("td",{class:"align-text-top pr-4 pb-4"},"0",-1)),ge={class:"align-text-top pr-4 pb-4"},ve=f(()=>e("td",{class:"align-text-top pr-4 pb-4"},"N/A",-1)),be={class:"align-text-top pr-4 pb-4"},fe={class:"col-md-6 px-12 py-4 h-100"},xe=f(()=>e("h4",{class:"mb-4"},"COMMENTS AND EXAMPLES",-1)),ye={class:"checkbox-group mb-2 example-list"},Ae={class:"mt-8"},we={class:"d-flex form-group"},Ve=f(()=>e("i",{class:"la la-plus"},null,-1)),ke={class:"card-footer d-flex justify-content-between",style:{"margin-left":"25%","margin-right":"25%"}},Ce={__name:"PrincipleAssessmentModal",props:{principleAssessment:Object,closing:Boolean},emits:["discard","next","close","update_rating"],setup(s,{emit:h}){const a=s,o=j(()=>{var i;return(i=a.principleAssessment.principle)!=null?i:null});j(()=>{var i;return(i=a.principleAssessment.assessment)!=null?i:null});const v=j(()=>a.principleAssessment.rating!==null||a.principleAssessment.is_na),V=$([]);function N(){a.principleAssessment.custom_score_tags.push({name:"",description:""});const i=a.principleAssessment.custom_score_tags.length-1;M(()=>V.value[i].focus())}function r(i){console.log("hi",i),a.principleAssessment.custom_score_tags.splice(i,1)}function _(){h("discard"),h("close")}async function n(i){a.principleAssessment.complete=v,v&&h("update_rating",a.principleAssessment),await axios.patch(`/principle-assessment/${a.principleAssessment.id}`,a.principleAssessment),h(i)}return E(()=>{a.principleAssessment.rating===null&&(a.principleAssessment.rating=0)}),(i,c)=>(p(),m(S,null,[u(q,{class:"px-0"},{default:A(()=>[e("h2",se,d(o.value.name),1)]),_:1}),u(W,{class:"px-0"},{default:A(()=>[e("div",te,[e("div",le,[e("div",null,[ae,e("p",ne,"Drag the slider to choose the rating for "+d(o.value.name)+". Refer to the definitions below if you are unsure.",1),u(Y,{modelValue:s.principleAssessment.rating,"onUpdate:modelValue":c[0]||(c[0]=t=>s.principleAssessment.rating=t),min:0,max:2,step:.1,"thumb-size":v.value?18:24,"thumb-label":v.value?"always":"never","thumb-color":v.value?"green":"grey","track-color":"light","track-fill-color":"success","show-ticks":"always",class:"ae-slider",disabled:s.principleAssessment.is_na},{"thumb-label":A(t=>[w(d(v.value?s.principleAssessment.rating:""),1)]),"tick-label":A(t=>[w(d(t.tick.value%1===0?t.tick.value:""),1)]),_:1},8,["modelValue","thumb-size","thumb-label","thumb-color","disabled"]),u(D,{class:"my-4",modelValue:s.principleAssessment.is_na,"onUpdate:modelValue":c[1]||(c[1]=t=>s.principleAssessment.is_na=t),label:`If ${o.value.name.toLowerCase()} is not applicable for this project, tick this box.`},null,8,["modelValue","label"]),s.principleAssessment.is_na?(p(),m("p",ie,"You may still add a comment to explain why "+d(o.value.name)+" is not applicable for this project.",1)):T("",!0)]),e("div",oe,[e("div",ce,[de,e("table",re,[e("tr",null,[pe,e("td",ue,d(o.value.rating_two),1)]),e("tr",null,[me,e("td",he,d(o.value.rating_one),1)]),e("tr",null,[_e,e("td",ge,d(o.value.rating_zero),1)]),e("tr",null,[ve,e("td",be,d(o.value.rating_na),1)])])])])]),e("div",fe,[xe,e("div",null,[u(G,{modelValue:s.principleAssessment.rating_comment,"onUpdate:modelValue":c[2]||(c[2]=t=>s.principleAssessment.rating_comment=t),label:"Add a comment to support your rating"},null,8,["modelValue"])]),e("div",null,[e("h6",null,"Presence of Examples / Indicators for "+d(o.value.name),1),e("p",null,"Below are some common examples of "+d(o.value.name)+" within a project. Tick the ones that are present within the project. You may also add additional examples below to further support the rating given.",1),(p(!0),m(S,null,I(o.value.score_tags,t=>(p(),m("div",ye,[u(D,{modelValue:s.principleAssessment.score_tag_ids,"onUpdate:modelValue":c[3]||(c[3]=k=>s.principleAssessment.score_tag_ids=k),value:t.id,label:t.name,density:"compact","hide-details":"auto"},null,8,["modelValue","value","label"])]))),256))]),e("div",Ae,[(p(!0),m(S,null,I(s.principleAssessment.custom_score_tags,(t,k)=>(p(),m("div",we,[u(H,{ref_for:!0,ref_key:"tagNameRefs",ref:V,modelValue:t.name,"onUpdate:modelValue":x=>t.name=x,label:"Enter a descriptive name for the example / indicator",density:"compact",variant:"underlined","append-icon":"mdi-delete","onClick:append":x=>r(k)},null,8,["modelValue","onUpdate:modelValue","onClick:append"])]))),256)),e("button",{class:"btn btn-secondary",onClick:N},[Ve,w(" Add New Example ")])])])])]),_:1}),e("div",ke,[e("div",{class:"btn btn-secondary",onClick:_},"Discard Changes"),e("div",{class:"btn btn-primary",onClick:c[4]||(c[4]=t=>n("close"))},"Save and Close"),e("div",{class:"btn btn-success",onClick:c[5]||(c[5]=t=>n("next"))},"Save and Next")])],64))}},$e=ee(Ce,[["__scopeId","data-v-4065560d"]]),Se={class:"card w-100 px-4 py-4 my-1"},Pe={class:"card-body"},je={class:"px-5 mx-5"},Ne=e("h3",{class:"text-bright-green font-weight-bold"},"Agrocological Principles Assessment",-1),Te=e("div",{class:"mb-5"},[w(" This is the main section of the review. Below are the 13 Agroecology Principles, and you should rate the project against each one. "),e("br"),e("br"),w(" For each principle, you should give: "),e("ul",null,[e("li",null,"A rating: This is a number between 0 and 2, based on your appreciation of the value of the principle in the project design / activities, and following the Spectrum defined for each principle. Decimal digits are allowed."),e("li",null,"A comment: Please add any comments to help explain the rating, and about how the principle is seen within the project.")]),w(" Each principle also lists a set of example activities relevant to that principle. Please tick all activities that are present in the project. "),e("br"),e("br"),e("b",{class:"text-deep-green"},"Click on a principle to begin:")],-1),Ie={class:"row"},De={class:"col-6"},Ee=["onClick"],Ue={class:"d-flex align-items-end"},Me={key:0,class:"py-0 m-0 pr-4",style:{"line-height":"1.3em"}},Be={class:"p-0 m-0 d-flex"},Oe={class:"ml-auto mr-auto"},Re={class:"ml-auto mr-auto d-flex flex-column align-items-center mt-4"},Fe=["action"],ze=["value"],Le=["disabled"],qe={__name:"AgroecologicalPrinciplesAssessment",props:{assessment:Object},async setup(s){let h,a;const o=s,v=document.querySelector('meta[name="csrf-token"]').getAttribute("content");async function V(){return(await axios.get(`/assessment/${o.assessment.id}/principle-assessments/`)).data}const N=([h,a]=R(()=>V()),h=await h,a(),h);let r=$(N),_=$({}),n=$(!1);E(()=>{i()});function i(){console.log("hi")}async function c(){r.value=await V(),n.value=!1}function t(){const g=r.value.indexOf(_.value);if(g+1>=r.value.length){n.value=!1;return}_.value=r.value[g+1]}const k=j(()=>r.value.every(g=>g.complete)),x=$(o.assessment.complete);function U(g){const b=r.value.findIndex(l=>l.id===g.id);r.value[b]=g}return(g,b)=>(p(),m(S,null,[e("div",Se,[e("div",Pe,[e("div",je,[Ne,Te,e("div",Ie,[(p(!0),m(S,null,I(y(r),l=>(p(),m("div",De,[e("div",{class:C(["card rounded-pill",l.complete?"bg-deep-green":"bg-light"]),onClick:Ge=>{P(_)?_.value=l:_=l,P(n)?n.value=!0:n=!0}},[e("button",{class:C(["card-body py-3 btn btn-light rounded-pill",l.complete?"bg-white":""])},[e("div",{class:C(["px-4 d-flex justify-content-between align-items-center",l.complete?"text-deep-green":""])},[e("span",null,d(l.principle.name),1),e("div",Ue,[l.complete?(p(),m("h5",Me,d(l.is_na?"N/A":Math.round(l.rating*10)/10),1)):T("",!0),e("h3",Be,[e("i",{class:C(l.complete?"la la-check-circle":"la la-edit")},null,2)])])],2)],2)],10,Ee)]))),256))])])]),e("p",Oe,"Once you have completed all "+d(y(r).length)+" principles, you may mark the assessment as complete below.",1)]),e("div",Re,[u(D,{label:"I confirm this assessment is complete and correct to the best of my knowledge.",density:"compact","hide-details":"always",disabled:!k.value,modelValue:x.value,"onUpdate:modelValue":b[0]||(b[0]=l=>x.value=l)},null,8,["disabled","modelValue"]),e("form",{method:"POST",action:`/admin/assessment/${s.assessment.id}/finalise`,class:"mt-4"},[e("input",{type:"hidden",name:"_token",value:y(v)},null,8,ze),e("button",{class:C(["btn",x.value?"btn-success":"btn-secondary"]),type:"submit",disabled:!x.value}," Finalise Assessment ",10,Le)],8,Fe)]),u(X,{modelValue:y(n),"onUpdate:modelValue":b[2]||(b[2]=l=>P(n)?n.value=l:n=l),width:"80vw",scrollable:!0},{default:A(()=>[u(J,null,{default:A(()=>[y(_)?(p(),F($e,{key:0,"principle-assessment":y(_),onDiscard:c,onClose:b[1]||(b[1]=l=>P(n)?n.value=!1:n=!1),onNext:t,onUpdate_rating:U},null,8,["principle-assessment"])):T("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}},Ye=K({components:Q,directives:Z});z().use(Ye).component("AgroecologicalPrinciplesAssessment",qe).component("Suspense",L).mount("#aePrinciplesAssessment");
