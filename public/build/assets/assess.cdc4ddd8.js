import{c as P,a as j,e as r,f as h,g as m,j as y,A as e,E as c,D as A,v as T,F as C,i as I,H as E,ag as U,ah as M,ai as O,o as B,m as x,y as k,q as S,s as R,V as F,W as z}from"./vue.esm-bundler.b2fc0ee9.js";import{b as L,e as q,f as D,g as Y,h as G,i as H,j as W,k as X,c as J,a as K,d as Q}from"./index.e96f1742.js";import{_ as Z}from"./_plugin-vue_export-helper.cdc0426e.js";const f=s=>(U("data-v-2f8ab1b4"),s=s(),M(),s),ee={class:"card-title text-bright-green pt-8 pb-0 px-12"},se={class:"h-100 d-flex"},te={class:"col-md-6 px-12 py-4 h-100"},le=f(()=>e("h4",null,"RATING",-1)),ae={class:"pb-8 mb-4"},ne={key:0,class:"alert alert-info"},ie={class:"card bg-bright-green text-white rounded-b-xl rounded-t-xl mb-16"},oe={class:"card-body p-4 px-8"},ce=f(()=>e("h3",{class:"card-title"},"Definitions",-1)),de={class:"align-text-top"},re=f(()=>e("td",{class:"align-text-top pr-4 pb-4"},"2",-1)),pe={class:"align-text-top pr-4 pb-4"},ue=f(()=>e("td",{class:"align-text-top pr-4 pb-4"},"1",-1)),me={class:"align-text-top pr-4 pb-4"},he=f(()=>e("td",{class:"align-text-top pr-4 pb-4"},"0",-1)),ge={class:"align-text-top pr-4 pb-4"},be=f(()=>e("td",{class:"align-text-top pr-4 pb-4"},"N/A",-1)),_e={class:"align-text-top pr-4 pb-4"},ve={class:"col-md-6 px-12 py-4 h-100"},fe=f(()=>e("h4",{class:"mb-4"},"COMMENTS AND EXAMPLES",-1)),xe={class:"checkbox-group"},ye={class:"mt-8"},Ae={class:"d-flex form-group"},we=f(()=>e("i",{class:"la la-plus"},null,-1)),Ve={class:"card-footer d-flex justify-content-between",style:{"margin-left":"25%","margin-right":"25%"}},ke={__name:"PrincipleAssessmentModal",props:{principleAssessment:Object,isOpen:Boolean},emits:["discard","next","close","update_rating"],setup(s,{emit:g}){const i=s,d=P(()=>{var n;return(n=i.principleAssessment.principle)!=null?n:null});P(()=>{var n;return(n=i.principleAssessment.assessment)!=null?n:null});const _=P(()=>i.principleAssessment.rating!==null||i.principleAssessment.is_na),w=j([]);function N(){i.principleAssessment.custom_score_tags.push({name:"",description:""});const n=i.principleAssessment.custom_score_tags.length-1;E(()=>w.value[n].focus())}function p(n){console.log("hi",n),i.principleAssessment.custom_score_tags.splice(n,1)}function u(){g("discard"),g("close")}async function a(n){i.principleAssessment.complete=_,_&&g("update_rating",i.principleAssessment),await axios.patch(`/principle-assessment/${i.principleAssessment.id}`,i.principleAssessment),g(n)}return(n,o)=>(r(),h(C,null,[m(L,{class:"px-0"},{default:y(()=>[e("h2",ee,c(d.value.name),1)]),_:1}),m(H,{class:"px-0"},{default:y(()=>[e("div",se,[e("div",te,[e("div",null,[le,e("p",ae,"Drag the slider to choose the rating for "+c(d.value.name)+". Refer to the definitions below if you are unsure.",1),m(q,{modelValue:s.principleAssessment.rating,"onUpdate:modelValue":o[0]||(o[0]=t=>s.principleAssessment.rating=t),min:0,max:2,step:.1,"thumb-size":_.value?18:24,"thumb-label":_.value?"always":"never","thumb-color":_.value?"green":"grey","track-color":"light","track-fill-color":"success","show-ticks":"always",class:"ae-slider",disabled:s.principleAssessment.is_na},{"thumb-label":y(t=>[A(c(_.value?s.principleAssessment.rating:""),1)]),"tick-label":y(t=>[A(c(t.tick.value%1===0?t.tick.value:""),1)]),_:1},8,["modelValue","thumb-size","thumb-label","thumb-color","disabled"]),m(D,{class:"my-4",modelValue:s.principleAssessment.is_na,"onUpdate:modelValue":o[1]||(o[1]=t=>s.principleAssessment.is_na=t),label:`If ${d.value.name.toLowerCase()} is not applicable for this project, tick this box.`},null,8,["modelValue","label"]),s.principleAssessment.is_na?(r(),h("p",ne,"You may still add a comment to explain why "+c(d.value.name)+" is not applicable for this project.",1)):T("",!0)]),e("div",ie,[e("div",oe,[ce,e("table",de,[e("tr",null,[re,e("td",pe,c(d.value.rating_two),1)]),e("tr",null,[ue,e("td",me,c(d.value.rating_one),1)]),e("tr",null,[he,e("td",ge,c(d.value.rating_zero),1)]),e("tr",null,[be,e("td",_e,c(d.value.rating_na),1)])])])])]),e("div",ve,[fe,e("div",null,[m(Y,{modelValue:s.principleAssessment.rating_comment,"onUpdate:modelValue":o[2]||(o[2]=t=>s.principleAssessment.rating_comment=t),label:"Add a comment to support your rating"},null,8,["modelValue"])]),e("div",null,[e("h6",null,"Presence of Examples / Indicators for "+c(d.value.name),1),e("p",null,"Below are some common examples of "+c(d.value.name)+" within a project. Tick the ones that are present within the project. You may also add additional examples below to further support the rating given.",1),(r(!0),h(C,null,I(d.value.score_tags,t=>(r(),h("div",xe,[m(D,{modelValue:s.principleAssessment.score_tag_ids,"onUpdate:modelValue":o[3]||(o[3]=V=>s.principleAssessment.score_tag_ids=V),value:t.id,label:t.name,density:"compact","hide-details":"auto"},null,8,["modelValue","value","label"])]))),256))]),e("div",ye,[(r(!0),h(C,null,I(s.principleAssessment.custom_score_tags,(t,V)=>(r(),h("div",Ae,[m(G,{ref_for:!0,ref_key:"tagNameRefs",ref:w,modelValue:t.name,"onUpdate:modelValue":$=>t.name=$,label:"Enter a descriptive name for the example / indicator",density:"compact",variant:"underlined","append-icon":"mdi-delete","onClick:append":$=>p(V)},null,8,["modelValue","onUpdate:modelValue","onClick:append"])]))),256)),e("button",{class:"btn btn-secondary",onClick:N},[we,A(" Add New Example ")])])])])]),_:1}),e("div",Ve,[e("div",{class:"btn btn-secondary",onClick:u},"Discard Changes"),e("div",{class:"btn btn-primary",onClick:o[4]||(o[4]=t=>a("close"))},"Save and Close"),e("div",{class:"btn btn-success",onClick:o[5]||(o[5]=t=>a("next"))},"Save and Next")])],64))}},Ce=Z(ke,[["__scopeId","data-v-2f8ab1b4"]]),$e={class:"card w-100 px-4 py-4 my-1"},Se={class:"card-body"},Pe={class:"px-5 mx-5"},je=e("h3",{class:"text-bright-green font-weight-bold"},"Agrocological Principles Assessment",-1),Ne=e("div",{class:"mb-5"},[A(" This is the main section of the review. Below are the 13 Agroecology Principles, and you should rate the project against each one. "),e("br"),e("br"),A(" For each principle, you should give: "),e("ul",null,[e("li",null,"A rating: This is a number between 0 and 2, based on your appreciation of the value of the principle in the project design / activities, and following the Spectrum defined for each principle. Decimal digits are allowed."),e("li",null,"A comment: Please add any comments to help explain the rating, and about how the principle is seen within the project.")]),A(" Each principle also lists a set of example activities relevant to that principle. Please tick all activities that are present in the project. "),e("br"),e("br"),e("b",{class:"text-deep-green"},"Click on a principle to begin:")],-1),Te={class:"row"},Ie={class:"col-6"},De=["onClick"],Ee={class:"d-flex align-items-end"},Ue={key:0,class:"py-0 m-0 pr-4",style:{"line-height":"1.3em"}},Me={class:"p-0 m-0 d-flex"},Oe={class:"ml-auto mr-auto"},Be={class:"ml-auto mr-auto d-flex flex-column align-items-center"},Re=["action"],Fe=["value"],ze={__name:"AgroecologicalPrinciplesAssessment",props:{assessment:Object},async setup(s){let g,i;const d=s,_=document.querySelector('meta[name="csrf-token"]').getAttribute("content");async function w(){return(await axios.get(`/assessment/${d.assessment.id}/principle-assessments/`)).data}const N=([g,i]=O(()=>w()),g=await g,i(),g);let p=j(N),u=j({}),a=j(!1);B(()=>{n()});function n(){console.log("hi")}async function o(){p.value=await w(),a.value=!1}function t(){const b=p.value.indexOf(u.value);if(b>=u.value.length){alert("complete"),a.value=!1;return}u.value=p.value[b+1]}const V=P(()=>p.value.every(b=>b.complete));function $(b){const v=p.value.findIndex(l=>l.id===b.id);p.value[v]=b}return(b,v)=>(r(),h(C,null,[e("div",$e,[e("div",Se,[e("div",Pe,[je,Ne,e("div",Te,[(r(!0),h(C,null,I(x(p),l=>(r(),h("div",Ie,[e("div",{class:k(["card rounded-pill",l.complete?"bg-deep-green":"bg-light"]),onClick:qe=>{S(u)?u.value=l:u=l,S(a)?a.value=!0:a=!0}},[e("button",{class:k(["card-body py-3 btn btn-light rounded-pill",l.complete?"bg-white":""])},[e("div",{class:k(["px-4 d-flex justify-content-between align-items-center",l.complete?"text-deep-green":""])},[e("span",null,c(l.principle.name),1),e("div",Ee,[l.complete?(r(),h("h5",Ue,c(l.is_na?"N/A":Math.round(l.rating*10)/10),1)):T("",!0),e("h3",Me,[e("i",{class:k(l.complete?"la la-check-circle":"la la-edit")},null,2)])])],2)],2)],10,De)]))),256))])])]),e("p",Oe,"Once you have completed all "+c(x(p).length)+" principles, you may mark the assessment as complete below.",1)]),e("div",Be,[m(D,{label:"I confirm this assessment is complete and correct to the best of my knowledge.",density:"compact","hide-details":"always",disabled:!V.value,modelValue:s.assessment.complete,"onUpdate:modelValue":v[0]||(v[0]=l=>s.assessment.complete=l)},null,8,["disabled","modelValue"]),e("form",{method:"POST",action:`/admin/assessment/${s.assessment.id}/finalise`},[e("input",{type:"hidden",name:"_token",value:x(_)},null,8,Fe),e("button",{class:k(["btn",s.assessment.complete?"btn-success":"btn-secondary"]),type:"submit"}," Finalise Assessment ",2)],8,Re)]),m(W,{modelValue:x(a),"onUpdate:modelValue":v[2]||(v[2]=l=>S(a)?a.value=l:a=l),width:"80vw",scrollable:!0},{default:y(()=>[m(X,null,{default:y(()=>[x(u)?(r(),R(Ce,{key:0,"principle-assessment":x(u),"is-open":x(a),onDiscard:o,onClose:v[1]||(v[1]=l=>S(a)?a.value=!1:a=!1),onNext:t,onUpdate_rating:$},null,8,["principle-assessment","is-open"])):T("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}},Le=J({components:K,directives:Q});F().use(Le).component("AgroecologicalPrinciplesAssessment",ze).component("Suspense",z).mount("#aePrinciplesAssessment");
